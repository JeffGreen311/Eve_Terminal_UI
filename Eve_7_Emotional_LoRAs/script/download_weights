#!/usr/bin/env python
"""Download SDXL weights before pushing to Replicate"""
import os
import shutil
from diffusers import DiffusionPipeline
import torch

CACHE_DIR = 'weights'

# Clean existing cache
if os.path.exists(CACHE_DIR):
    shutil.rmtree(CACHE_DIR)
os.makedirs(CACHE_DIR)

print("ðŸ”½ Downloading SDXL base model (this will take a few minutes)...")

# Download SDXL pipeline
pipe = DiffusionPipeline.from_pretrained(
    "stabilityai/stable-diffusion-xl-base-1.0",
    torch_dtype=torch.float16,
    use_safetensors=True,
    variant="fp16",
    cache_dir=CACHE_DIR
)

print("âœ… SDXL weights downloaded and cached!")
print(f"ðŸ“¦ Cache size: {sum(os.path.getsize(os.path.join(dirpath, filename)) for dirpath, dirnames, filenames in os.walk(CACHE_DIR) for filename in filenames) / (1024**3):.2f} GB")
